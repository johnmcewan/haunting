
{% extends "mapping/base.html" %}

{% load static %}

{% block content %}

    <main class="main-content">
        <div class="story-submission-container">
            <div class="submission-header">
                <h1 class="submission-title">üëª Haunted Lawrence Cases üëª</h1>
                <p class="submission-subtitle">
                    Explore the documented paranormal encounters and ghostly residents of Lawrence, Kansas.
                    Each case has been carefully catalogued from historical records and eyewitness accounts.
                </p>
            </div>

            <!-- Search and Filter Section -->
            <div class="search-filter-section">
                <div class="search-container">
                    <input type="text" id="searchInput" placeholder="üîç Search haunting cases..." class="search-input">
                </div>
                
                <div class="filter-container">
                    <select id="typeFilter" class="filter-select">
                        <option value="">All Haunting Types</option>
                    </select>
                    
                    <select id="locationFilter" class="filter-select">
                        <option value="">All Locations</option>
                    </select>
                    
                    <button id="clearFilters" class="clear-filters-btn">Clear Filters</button>
                </div>
            </div>

            <!-- Results Counter -->
            <div class="results-info">
                <span id="resultsCount">{{ haunting_set|length }}</span> haunting cases found
            </div>

            <!-- Haunting Cases Grid -->
            <div class="haunting-grid" id="hauntingGrid">
                {% for ghost_id, ghost in haunting_set.items %}
                    <div class="haunting-card" 
                         data-haunting-type="{{ ghost.hauntingtype|default:'Unknown' }}"
                         data-location="{{ ghost.location_name|default:'Unknown Location' }}">
                        
                        <div class="haunting-card-header">
                            <h3 class="haunting-title">
                                <a href="/haunting/{{ ghost.id_haunting }}">
                                    {{ ghost.haunting_name|default:"Unnamed Haunting" }}
                                </a>
                            </h3>
                            <div class="haunting-meta">
                                <span class="haunting-type">
                                    {% if ghost.hauntingtype %}
                                        üè∑Ô∏è {{ ghost.hauntingtype }}
                                    {% else %}
                                        üè∑Ô∏è Unknown Type
                                    {% endif %}
                                </span>
                                <span class="haunting-location">
                                    üìç {{ ghost.location_name|default:"Unknown Location" }}
                                </span>
                            </div>
                        </div>
                        
                        <div class="haunting-card-body">
                            {% if ghost.haunting_storyabstract %}
                                <p class="haunting-description">
                                    {{ ghost.haunting_storyabstract|truncatewords:30 }}
                                </p>
                            {% else %}
                                <p class="haunting-description no-description">
                                    A mysterious haunting with details yet to be fully documented...
                                </p>
                            {% endif %}
                        </div>
                        
                        <div class="haunting-card-footer">
                            <a href="/haunting/{{ ghost.id_haunting }}" class="read-more-btn">
                                üëÅÔ∏è Read Full Case
                            </a>
                        </div>
                    </div>
                {% empty %}
                    <div class="no-results">
                        <h3>üëª No Haunting Cases Found</h3>
                        <p>The spirits seem to be hiding... Try adjusting your search criteria.</p>
                    </div>
                {% endfor %}
            </div>

            <!-- Load More Button (for future pagination) -->
            <div class="load-more-section" style="display: none;">
                <button class="load-more-btn">
                    üîÆ Load More Cases
                </button>
            </div>
        </div>
    </main>

    <style>
        /* Search and Filter Styles */
        .search-filter-section {
            background: linear-gradient(145deg, #2a2a3e, #1e1e30);
            border-radius: 15px;
            padding: 2rem;
            margin: 2rem 0;
            border: 2px solid #8B4513;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .search-container {
            margin-bottom: 1.5rem;
        }

        .search-input {
            width: 100%;
            padding: 1rem;
            background: rgba(0,0,0,0.3);
            border: 2px solid #8B4513;
            border-radius: 8px;
            color: #e0e0e0;
            font-family: 'Cinzel', serif;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 15px rgba(255, 107, 53, 0.3);
        }

        .search-input::placeholder {
            color: #888;
        }

        .filter-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-select {
            flex: 1;
            min-width: 200px;
            padding: 0.75rem;
            background: rgba(0,0,0,0.3);
            border: 2px solid #8B4513;
            border-radius: 8px;
            color: #e0e0e0;
            font-family: 'Cinzel', serif;
            cursor: pointer;
        }

        .filter-select:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 10px rgba(255, 107, 53, 0.3);
        }

        .clear-filters-btn {
            background: linear-gradient(145deg, #8B4513, #ff6b35);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-family: 'Griffy', cursive;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .clear-filters-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        /* Results Info */
        .results-info {
            text-align: center;
            color: #d4a574;
            font-family: 'Griffy', cursive;
            font-size: 1.1rem;
            margin: 1rem 0;
        }

        /* Haunting Grid */
        .haunting-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .haunting-card {
            background: linear-gradient(145deg, #2a2a3e, #1e1e30);
            border-radius: 15px;
            border: 2px solid #8B4513;
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .haunting-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #ff6b35, #d4a574, #ff6b35);
        }

        .haunting-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.4), 0 0 25px rgba(255, 107, 53, 0.2);
        }

        .haunting-card-header {
            padding: 1.5rem 1.5rem 0;
        }

        .haunting-title {
            margin: 0 0 1rem 0;
        }

        .haunting-title a {
            color: #ff6b35;
            text-decoration: none;
            font-family: 'Griffy', cursive;
            font-size: 1.3rem;
            display: block;
            transition: all 0.3s ease;
        }

        .haunting-title a:hover {
            text-shadow: 0 0 8px #ff6b35;
            transform: translateX(5px);
        }

        .haunting-meta {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .haunting-type, .haunting-location {
            color: #c0c0c0;
            font-family: 'Cinzel', serif;
        }

        .haunting-card-body {
            padding: 1rem 1.5rem;
        }

        .haunting-description {
            color: #e0e0e0;
            line-height: 1.6;
            margin: 0;
        }

        .haunting-description.no-description {
            color: #888;
            font-style: italic;
        }

        .haunting-card-footer {
            padding: 0 1.5rem 1.5rem;
        }

        .read-more-btn {
            display: inline-block;
            background: linear-gradient(145deg, #8B4513, #ff6b35);
            color: white;
            text-decoration: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-family: 'Griffy', cursive;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .read-more-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        /* No Results */
        .no-results {
            grid-column: 1 / -1;
            text-align: center;
            padding: 3rem;
            color: #888;
        }

        .no-results h3 {
            color: #ff6b35;
            font-family: 'Griffy', cursive;
            margin-bottom: 1rem;
        }

        /* Load More */
        .load-more-section {
            text-align: center;
            margin: 2rem 0;
        }

        .load-more-btn {
            background: linear-gradient(145deg, #8B4513, #ff6b35);
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-family: 'Griffy', cursive;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .load-more-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 53, 0.4);
        }

        /* Hidden class for filtering */
        .haunting-card.hidden {
            display: none;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .haunting-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .filter-container {
                flex-direction: column;
            }
            
            .filter-select {
                min-width: auto;
                width: 100%;
            }
        }
    </style>

    <script>
        // Initialize particles
        createParticles();

        // Search and Filter functionality
        document.addEventListener('DOMContentLoaded', function() {
            const searchInput = document.getElementById('searchInput');
            const typeFilter = document.getElementById('typeFilter');
            const locationFilter = document.getElementById('locationFilter');
            const clearFiltersBtn = document.getElementById('clearFilters');
            const hauntingCards = document.querySelectorAll('.haunting-card');
            const resultsCount = document.getElementById('resultsCount');

            // Populate filter options
            populateFilters();

            // Event listeners
            searchInput.addEventListener('input', filterCards);
            typeFilter.addEventListener('change', filterCards);
            locationFilter.addEventListener('change', filterCards);
            clearFiltersBtn.addEventListener('click', clearAllFilters);

            function populateFilters() {
                const types = new Set();
                const locations = new Set();

                hauntingCards.forEach(card => {
                    const type = card.dataset.hauntingType;
                    const location = card.dataset.location;
                    
                    if (type && type !== 'Unknown') types.add(type);
                    if (location && location !== 'Unknown Location') locations.add(location);
                });

                // Add options to type filter
                Array.from(types).sort().forEach(type => {
                    const option = document.createElement('option');
                    option.value = type;
                    option.textContent = type;
                    typeFilter.appendChild(option);
                });

                // Add options to location filter
                Array.from(locations).sort().forEach(location => {
                    const option = document.createElement('option');
                    option.value = location;
                    option.textContent = location;
                    locationFilter.appendChild(option);
                });
            }

            function filterCards() {
                const searchTerm = searchInput.value.toLowerCase();
                const selectedType = typeFilter.value;
                const selectedLocation = locationFilter.value;
                let visibleCount = 0;

                hauntingCards.forEach(card => {
                    const title = card.querySelector('.haunting-title a').textContent.toLowerCase();
                    const description = card.querySelector('.haunting-description').textContent.toLowerCase();
                    const type = card.dataset.hauntingType;
                    const location = card.dataset.location;

                    const matchesSearch = !searchTerm || 
                        title.includes(searchTerm) || 
                        description.includes(searchTerm) ||
                        type.toLowerCase().includes(searchTerm) ||
                        location.toLowerCase().includes(searchTerm);
                    
                    const matchesType = !selectedType || type === selectedType;
                    const matchesLocation = !selectedLocation || location === selectedLocation;

                    if (matchesSearch && matchesType && matchesLocation) {
                        card.classList.remove('hidden');
                        visibleCount++;
                    } else {
                        card.classList.add('hidden');
                    }
                });

                // Update results count
                resultsCount.textContent = visibleCount;
            }

            function clearAllFilters() {
                searchInput.value = '';
                typeFilter.value = '';
                locationFilter.value = '';
                
                hauntingCards.forEach(card => {
                    card.classList.remove('hidden');
                });
                
                resultsCount.textContent = hauntingCards.length;
            }

            // Add spooky hover effects
            hauntingCards.forEach(card => {
                card.addEventListener('mouseenter', function() {
                    this.style.boxShadow = '0 15px 35px rgba(0,0,0,0.4), 0 0 25px rgba(255, 107, 53, 0.3)';
                });
                
                card.addEventListener('mouseleave', function() {
                    this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.3)';
                });
            });
        });
    </script>

{% endblock %}
